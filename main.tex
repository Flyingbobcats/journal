\documentclass[conf]{new-aiaa}
%\documentclass[journal]{new-aiaa} for journal papers
\usepackage[utf8]{inputenc}

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage[version=4]{mhchem}
\usepackage{siunitx}
\usepackage{longtable,tabularx}
\usepackage{float}
\usepackage{subfigmat}
\usepackage{setspace}
%\doublespacing

\floatstyle{boxed}
\restylefloat{figure}

\setlength\LTleft{0pt} 

\title{Vector field  path following and obstacle avoidance singularity mitigation via look-ahead flight envelope}

\author{First A. Author\footnote{Insert Job Title, Department Name, Address/Mail Stop, and AIAA Member Grade (if any) for first author.} and Second B. Author Jr.\footnote{Insert Job Title, Department Name, Address/Mail Stop, and AIAA Member Grade (if any) for second author.}}
\affil{Business or Academic Affiliation 1, City, State, Zip Code}
\author{Third C. Author\footnote{Insert Job Title, Department Name, Address/Mail Stop, and AIAA Member Grade (if any) for third author.}}


\begin{document}

\maketitle

\begin{abstract}



Unmanned Aerial Vehicles conventionally navigate by following a series of pre-planned waypoints that may have to be re-planned when flying in a dynamic environment or encountering previously unknown obstacles. Waypoints are generally planned off-line and relayed to the UAV, taking up time and autopilot communication resources. Attractive path following and repulsive obstacle avoidance vector fields have been summed together to produce UAV guidance that follows pre-planned paths and avoids obstacles without the need to re-plan. Summing attractive and repulsive vector fields may produce small regions of null guidance, called singularities, which could potentially lead to trap situations. An investigation into singularity mitigation by vector field weight parameterization is presented. 


\end{abstract}



\section{Nomenclature}

{\renewcommand\arraystretch{1.0}
\noindent\begin{longtable*}{@{}l @{\quad=\quad} l@{}}
$UAV$  & Unmanned Aerial Vehicle \\
$VF$   & Vector Field \\
$VFF$  & Virtual Force Field \\
$LVF$  & Lyapunov Vector Field \\
$GVF$  & Goncalves Vector Field \\
$\overrightarrow{X}$  & UAV position \\
$\overrightarrow{U}$  & UAV velocity \\
$\theta$  & UAV heading \\
$\dot{\theta}$  & UAV heading rate \\
$u$  & UAV speed \\
$dt$  & discrete time step\\


$\overrightarrow{V}_{conv}$  & Convergence Vector\\
$\overrightarrow{V}_{circ}$  & Circulation Vector\\

$G$  & Convergence Weight\\
$H$  & Circulation Weight\\
$V$  & Potential Function\\

$r_O$  & Obstacle Radius\\
$R$  & Decay Radius\\
$\gamma$  & Path Deviation Cost\\
$\alpha_i$  & Surface Function\\

$x$  & UAV horizontal position\\
$y$  & UAV vertical position\\

$x_c$  & Circular obstacle horizontal position\\
$y_c$  & Circular obstacle vertical position\\

$d$  & Range to obstacle\\

$P$  & Obstacle Decay Weight\\




\end{longtable*}}

\section{Introduction}


%Paths have already been deemed to meet mission requirements
%Avoiding obstacles while minimizing deviation from the prescribed path would be benefitial
%Planning missions (path connecting sequential tasks)
%Following path with waypoints
%
%
%There are many methods for planning obstacle free and flyable paths, however in general the methods can be simplified into two steps consisting of optimization and path refinement. Optimization determines the least cost straight line path which is further refined to ensure the path is flyable.
%
%INTRODUCTION TO UAVS


%Unmanned Aerial Vehicles (UAV)s are pilotless aircraft used by military, police, and civilian communities for tasks such as reconnaissance, damage assessment, surveying, and target tracking \cite{ariyur_autonomous_2008,teuliere_chasing_2011}. Many of these tasks depend on the UAVs ability to autonomously follow a pre-planned path while potentially avoiding obstacles. Pre-planned paths are typically generated on a remote ground station and relayed to the UAV’s autopilot. On-board guidance systems attempt to minimize the lateral error to the path by commanding a heading pointing to the path. Guidance methods for following a pre-planned path include geometric methods such as waypoint or carrot chasing and control techniques such as proportional-integral-derivative (PID), non-linear guidance laws, and linear quadratic regulator (LQR) \cite{sujit_unmanned_2014}. Due to traditional guidance method's dependence on a path planner to construct an obstacle free and flyable path, these methods often lack a mechanism to avoid obstacles unknown during planning. Re-planning and relaying a new obstacle free path may be impossible under certain conditions, such as flying beyond line-of-sight. Path planning on-board to avoid a new obstacle could be accomplished by inserting a new temporary path or by completely re-planning, however introduces several challenges such as waypoint placement and density. \\
%
%Additional methods for avoiding obstacles in real time include potential field \cite{borenstein_real-time_1990,borenstein_vector_1991} and vector field \cite{frew_cooperative_2007,griffiths_vector_2006,goncalves_artificial_2009,goncalves_circulation_2010,goncalves_vector_2010} which employ the use of artificial attractive and repulsive forces to pull a UAV towards a goal while pushing away from nearby obstacles. Potential field has been used as a path planner and guidance system in obstacle rich environments, however potential field suffers from several limitations including local minima, oscillations, and may cause excess deviation from the desired path. Vector field guidance (VFG) converges and circulates a pre-defined path and may be summed with additional repulsive vector fields to produce an obstacle avoidance. Each field's behavior can be modified by weighting convergence, circulation, and time-varying components by multiplicative scalars. Previous investigations into vector field obstacle avoidance only considered negative static weights for convergence which did not aid in circumnavigating an obstacle and can introduce conditions which lead to guidance singularities. Further optimization of vector fields decay radii and circulation weights may produce an improved avoidance guidance while also removing singularities from the UAVs route. \\
%
%The contribution of this study is to demonstrate a vector field parameter optimization method for determining decay radius and circulation weights for a real-time guidance that circumnavigates obstacles which lie along a pre-planned path while also removing singularities from the UAVs route. A method for determining obstacle decay radius, circulation, and repulsion such that a UAV avoids obstacles while minimizing deviation from the planned path is presented. The modified guidance will then be compared against waypoint, Potential Field, and un-modified path following guidance in simulation for cross track error from planned path.\\
%
%============================================\\
Unmanned aerial vehicles (UAV)s are pilotless aircraft used by military, police, and civilian communities for tasks such as reconnaissance, damage assessment, surveying, and target tracking \cite{ariyur_autonomous_2008,teuliere_chasing_2011}. Many of these tasks depend on the UAVs ability to autonomously follow a path while potentially avoiding obstacles and no-fly zones. Paths are typically followed by implementing guidance systems such as waypoint, carrot chasing, proportional-integral-derivative (PID), non-linear guidance laws, or linear quadratic regulator (LQR). Conventional path following guidance systems are typically not capable of avoiding obstacles without partially or completely re-planning the path. Paths are typically generated on a remote ground station and relayed to the UAV’s autopilot which may be impossible under certain conditions, such as flying beyond line-of-sight. Avoiding obstacles without path re-planning has been achieved with potential field \cite{borenstein_real-time_1990,borenstein_vector_1991} and vector field \cite{frew_cooperative_2007,griffiths_vector_2006,goncalves_artificial_2009,goncalves_circulation_2010,goncalves_vector_2010} guidance.\\

 Potential field employs the use of artificial attractive and repulsive forces that pull a UAV towards a goal while locally pushing away from nearby obstacles.  Several limitations with potential field were identified in \cite{koren_potential_1991} including local minima and oscillations. Additionally, potential field may cause excess deviation from the desired path and provides guidance for converging to a singular point which is not ideal for fixed wing UAVs.
Gradient vector field (GVF) provides a continuous heading guidance that directs a UAV to converge and follow an arbitrary path. The GVF method was modified in the standoff tracking scenario in [wwc] to include obstacle avoidance by summing an attractive GVF with repulsive obstacle GVFs. The repulsive GVFs pushed the UAV away from keep-out zones while allowing the UAV to return to the desired path. \\

The standoff tracking scenario in [wwc] did not address the possibility of attractive and repulsive vector fields canceling, leading to guidance singularities. Additionally, no method for determining the radius of the decay field was specified to minimize deviation from the planned path. A method for locating singularities in a summed vector field is presented, followed by an improved GVF for circular obstacle avoidance method. The improved GVF is compared in simulation to waypoint and potential field and it is shown to have favorable obstacle avoidance.


%The GVF method was modified in the standoff tracking scenario presented in [wwc] where a fixed wing UAV was tasked with tracking a slower moving ground target while avoiding static obstacles. An attractive circular GVF was attached to the moving ground target which guided the fixed wing UAV to enter a loiter orbit around the target. Circular repulsive vector fields were attached to the static obstacles and summed with the attractive GVF. The repulsive GVFs pushed the UAV away from keep-out zones while allowing the UAV to return to the desired loiter path. \\







%Unmanned Aerial Vehicles (UAV)s are pilotless aircraft used by military, police, and civilian communities for tasks such as reconnaissance, damage assessment, surveying, and target tracking \cite{ariyur_autonomous_2008,teuliere_chasing_2011}. Tasks can be performed by a single UAV or cooperate with a team of other air, ground, or marine vehicles \cite{oh_coordinated_2013,hyondong_oh_coordinated_2015,ulun_coordinated_2013}. UAVs are ideal for remote data collection due to their low cost, endurance, and reduced risk to human life. Data can be collected by loitering the aircraft around an area of interest (AOI) or along a sensor path, such as a road or tree-line. Missions for collecting data are typically pre-planned on a remote ground station where an obstacle free and flyable path is generated. Typically paths are deconstructed into a series of discrete waypoints that the UAV navigates to through the use of a line-of-sight guidance. While navigating the pre-planned path previously unknown obstacles may be discovered and a new obstacle free path may have to be generated, which may be difficult or impossible if the UAV is out of radio range. Additional methods for avoiding obstacles in real time include potential field and vector field which employ the use of artificial attractive and repulsive forces to pull a UAV towards a goal while pushing away from obstacles. Potential field is a popular solution to both path planning and guidance problems in obstacle rich environments, however suffers from several limitations including local minima, oscillations, and may cause excess deviation from the desired sensor line. Vector field guidance converges and circulates a pre-defined path and may be summed with additional repulsive vector fields to produce an obstacle avoidance. Previous methods only considered repulsive fields which do not aid in circumnavigating an obstacle and also introduce conditions which may lead to vector field singularities. \\
%
% Further optimization of vector fields to include circulation may produce an efficient real-time guidance for avoiding obstacles while also removing singularities from the UAVs path. A method for determining obstacle decay radius, circulation, and repulsion such that a UAV avoids obstacles while minimizing path deviation is presented. The modified guidance will then be compared against waypoint, Potential Field, and un-modified path following guidance in simulation for cross track error and deviation from sensor path. Lastly, the optimized vector field will then be demonstrated on a crazyflie 2.0 multi-rotor simulating fixed wing constraints. 

\section{Literature}
UAVs autonomously following a pre-planned path can accomplished with waypoint or path following guidance. Conventionally, obstacle free and flyable paths are constructed by on off-board path planner and decomposed into a series of discrete waypoints. An on-board autopilot directs the UAV to follow the series of waypoints in sequential order. Waypoint guidance aligns the vehicle with the current active waypoint that lies along a pre-planned path. If an obstacle lies along that sensor path, the UAV must avoid the obstacle but also return back to the sensor path such that a minimal length of the path is missed during data collection. The number of waypoints that divert around an obstacle effects how closely the UAV tracks the outside of the obstacle and how much of the original path can be traveled. Few obstacle diversion waypoints leads to excess path deviation. Increasing the number of diversion waypoints reduces path deviation, however has diminishing returns. An example of a UAV following diversion waypoints is shown in Figure \ref{fig:numWaypointsPath}. The UAV is directed to follow a series of waypoints around an obstacle, traveling in straight lines and circular arcs.



%Typically the criteria for switching waypoints involves the UAV passing through a radius surround the current active waypoint. Due to the waypoint radius, waypoints may have to be placed further way from the obstacle to ensure the obstacle is not violated, causing the UAV to deviate and spend more time away from the sensor path. 
%
% A geometrically optimal path around a circular obstacle for a vehicle with fixed turn rate constraints can be generated in three steps. First, the UAV turns away from the obstacle such that it eventually becomes tangent to the obstacle radius. The vehicle then would proceed to follow the outside of the obstacle until nearly approaching the original sensor path. The UAV would then turn back towards the intended sensor path. An example of a series of waypoints that route a UAV with fixed wing constraints around an obstacle is shown in Figure \ref{fig:purewaypoint} below. 




%Generating a path to avoid an obstacle that lies on top of a sensor line can be constructed by considering the UAV turning radius and the radius of the obstacle.
%- Reconstruct path into discrete waypoints
%- Relay waypoints to a UAVs autopilot where guidance directs UAV towards waypoints
%- Planned at a ground station
%- Collision free path
%- Further optimized for vehicle constraints
%- Waypoints not optimal
%- Placed so radius is outside of obstacle
%- Generation is typically performed off-board
%- Communication with vehicle may not be possible
%- Obstacle avoidance may be achieved in the guidance system instead of path planning
% When collecting data it is important to stay as close to a prescribed path as possible to maximize sensor coverage of the area while avoiding collisions.
% 
% Obstacle free and flyable paths are typically pre-planned and generated off-line at a dedicated ground station using a path planner. 
% 
% Many methods can be used for generating paths, however the process is generally executed in two steps consisting of optimization and refinement. Optimization builds shortest path taking in constraints such as obstacles and mission objectives. 
% 
% The optimized path is then refined to meet a vehicles dynamic constraints, such as turn rate and velocity. UAVs using a line-of-sight guidance are sent a series of waypoints that lie along the pre-planned path over radio. The autopilot's guidance system directs the UAV to turn the crafts heading towards the current active waypoint, traveling in circular arcs and straight paths.  Curved sections of the refined path may require a dense spacing of waypoints to ensure the UAV tracks the refined path accurately. An example of a UAV following a series of waypoints that lie along a prescribed path is shown in Figure (). 

%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=1\linewidth]{Figures/simpleWaypointsWithUAVPath}
%	\caption{UAV path from waypoint guidance}
%	\label{fig:simplewaypointsWithUAVPath}
%\end{figure}



\begin{figure}[H]
	\begin{subfigmatrix}{2}% number of columns
		\centering	
		\subfigure []{\includegraphics[width=8cm,trim=40 0 60 0,clip] {Figures/Waypoints/1Wpts}}
		\subfigure []{\includegraphics[width=8cm,trim=40 0 60 0,clip] {Figures/Waypoints/6Wpts}}
		\hspace*{0mm}
	\end{subfigmatrix}
	\caption{Obstacle Diversion Waypoints}
	\label{fig:numWaypointsPath}
\end{figure}


A cost function $\gamma$ can be used to measure the deviation from a planned path while avoiding obstacles with diversion waypoints, shown in Equation \ref{eq:diversionCost}. Increasing the number of waypoints improves the UAVs ability to track the outside of the obstacle and increases the amount of the pre-planned path covered. 

\begin{equation}
\label{eq:diversionCost}
\begin{aligned}
\gamma =  \frac{1}{r_O}\int_{0}^{tf}ydt
\end{aligned}
\end{equation}

\begin{figure}[H]
	\centering
	\includegraphics[width=10cm]{Figures/Waypoints/costVnumWpts}
	\caption{Cost impact versus number of waypoints}
	\label{fig:numWaypoints}
\end{figure}

Potential field is based on the principle of artificial attractive and repulsive forces acting on a point mass to guide a system to a desired goal while avoiding static and dynamic obstacles \cite{khatib_real-time_1986}. Goals are represented as an attractive force that pull a point mass in the direction of minimal energy while obstacles are represented as repulsive forces that act locally to push the point mass away. Potential field is also capable of acting as a path and trajectory planning algorithm \cite{rimon_exact_1992}, possibly eliminating the off-board path planner. An example of potential field can be found in \cite{borenstein_real-time_1990,borenstein_vector_1991,koren_potential_1991} which allowed for real time goal seeking with obstacle avoidance on a mobile ground robot equipped with ultrasonic sensors. The robot was attracted towards a goal with constant magnitude force. In the immediate area of the robot, an active window exists which records integer certainty values inside discrete cells. Cells containing an obstacle provide a repulsive force opposite in direction to the line-of-sight from vehicle to cell location. The total repulsive force exerted on the robot is determined by summing the active cells. Summing together attractive and repulsive forces produce a vector that can be used for heading guidance. \\

%\begin{equation}\label{eq:vffGoal}
%\overrightarrow{F_t} = F_{ct} \bigg( \frac{x_t-x_0}{d_{t}}\hat{x} + \frac{y_t-y_0}{d_{t}}\hat{y}\bigg)
%\end{equation}
%
%\begin{equation}\label{eq:vffRepulse}
%\overrightarrow{F_{i,j}} = \frac{F_{cr}W^nC_{i,j}}{d^n_{i,j}} \bigg( \frac{x_i-x_0}{d_{i,j}}\hat{x} + \frac{y_i-y_0}{d_{i,j}}\hat{y}\bigg)
%\end{equation}

%The total repulsive force exerted on the robot is determined by summing the active cells, shown in Equation \ref{eq:vffRepulseSum}
%
%
%\begin{equation}\label{eq:vffRepulseSum}
%\overrightarrow{F_r} = \sum_{i,j}\overrightarrow{F_{i,j}}
%\end{equation}




%Summing together attractive and repulsive forces produce a vector $\overrightarrow{R}$ that can be used for heading guidance, shown in Equation \ref{eq:vffHeading}.

%\begin{equation}\label{eq:vffHeading}
%\overrightarrow{R} = \overrightarrow{F_r} + \overrightarrow{F_t}
%\end{equation}

Major drawbacks to potential field were identified in \cite{koren_potential_1991} consisting of local minimum and oscillations in corridors. The local minimum problem occurs when closely spaced obstacle's potential combine to produce a well on the descent gradient where a pre-mature stable point is reached. Proposed solutions to local minimum include object clustering and virtual waypoint method \cite{liu_virtual-waypoint_2016}, virtual escaping route \cite{kim_escaping_2009}, and use of navigation functions \cite{goerzen_survey_2010}. Oscillations in potential field were addressed in \cite{lei_tang_novel_2010} and \cite{li_efficient_2012}. In addition to local minimum and oscillations, potential field may not be ideal for providing guidance to return to a sensor path after avoiding an obstacle. Once the obstacle has been avoided, the attractive goal will direct the UAV in a straight path which may not lie along the sensor line. Guidance that follows an explicit path, deviates when necessary to avoid obstacles, and return back to the explicit path quickly can be accomplished with path following vector fields.  \\


%\subsection{Vector Field Guidance}

Vector fields produce continuous heading guidance that asymptotically converges and circulates a path. A comparison between vector field and waypoint guidance techniques was presented in \cite{sujit_unmanned_2014} where each method was evaluated based on its complexity, robustness, and accuracy. The vector field model produced guidance that was both robust to external wind disturbances while maintaining a low cross track error. The two most prominent methods for generating vector fields in literature consist of the Lyapunov Vector Field (LVF) \cite{nelson_cooperative_2005,nelson_vector_2006,nelson_vector_2007,frew_cooperative_2007,miao_orthogonal_2016,griffiths_vector_2006} and Gradient Vector Field (GVF) \cite{goncalves_artificial_2009,goncalves_circulation_2010,goncalves_vector_2010,gerlach_autonomous_2014} method. LVFs for converging and following straight and circular paths were described in \cite{nelson_cooperative_2005}. Straight and circular path vector fields can be selectively activated throughout flight to form more complex paths, shown in \cite{nelson_cooperative_2005,nelson_vector_2006,nelson_vector_2007,jung_unmanned_2016}. LVF for curved path following was presented in \cite{griffiths_vector_2006} which may allow for more complex paths and eliminates the need to switch between vector fields. \\

%\subsection{GVF}
The Gradient Vector Field (GVF) method produces a similar field to LVF, however has several advantages over LVFs. GVF produces an \textit{n}-dimensional vector field that converges and circulates to both static and time varying paths, which may be useful for tracking dynamic paths or avoiding dynamic obstacles. Additionally, convergence, circulation, and time-varying terms that make up the GVF are decoupled from each other allowing for easy weighting of the total field. GVFs converge and circulate at the intersection, or level set, of $n-1$ dimensional implicit surfaces ($\alpha_i:\mathbb{R}^n\rightarrow\mathbb{R} | i=1,...,n-1$). The integral lines of the field are guaranteed to converge and circulate the level set when two conditions are met: $1)$ the implicit surface functions are positive definite and $2)$ have bounded derivatives. %Consider the space with dimensions in set \textbf{q}:

%The Goncalves Vector Field (GVF) method for producing vector fields has several advantages over the Lyapunov vector field generation methods.


%\begin{equation}
%\mathbf{q} = \begin{bmatrix} x_1, x_2, ..., x_{n}\end{bmatrix}
%\end{equation}

The total vector field for a static path $\overrightarrow{V}$ is calculated by:
\begin{equation}\label{eq:GVF}
\overrightarrow{V} = G \nabla V + H \wedge_{i=1}^{n-1}\nabla\alpha_i
\end{equation}

or in component form:

\begin{equation}\label{eq:simpleGVF}
\overrightarrow{V} = G\overrightarrow{V}_{conv} + H\overrightarrow{V}_{circ} 
\end{equation}	

where $\overrightarrow{V}_{conv}$ produces vectors perpendicular to the path and $\overrightarrow{V}_{circ}$ produces vectors parallel to the path. The multiplicative factors $G$, $H$, and $L$ are scalar weights to influence the strength of each field component.

Convergence is calculated by:

\begin{equation}
% Total field with Conv, Circ, and Time
\overrightarrow{V}_{conv} = \nabla V  
\label{convOnly}
\end{equation}

where the potential function $V$ is:

\begin{equation}
V = -\sqrt{{\alpha_1}^2 + {\alpha_2}^2}
\end{equation}

\begin{equation}
\label{eq:gradV}
\nabla V =\begin{bmatrix}
\frac{dV}{dx} \\
\frac{dV}{dy} \\
\frac{dV}{dz}
\end{bmatrix}
\end{equation}



Circulation is calculated by taking the wedge product of the gradients of the surface functions:

\begin{equation}
% Total field with Conv, Circ, and Time
\overrightarrow{V}_{circ} =  \wedge_{i=1}^{n-1}\nabla\alpha_i 
\label{circOnly}
\end{equation}

In the case of $(n=3)$ the wedge product simplifies as the cross product:

\begin{equation}
% Total field with Conv, Circ, and Time
\overrightarrow{V}_{circ} =  \nabla\alpha_1 \times \nabla\alpha_2 
\label{circOnlySimp}
\end{equation}

%The feed-forward time-varying component is calculated by:
%\begin{equation}
%\label{tv}
%\overrightarrow{V}_{tv} = M^{-1}a
%\end{equation}
%
%where,
%
%\begin{equation}
%\label{mMatrix}
%M =\begin{bmatrix}
%\nabla\alpha_1^T \\
%\nabla\alpha_2^T \\
%(\nabla\alpha_1 \times \nabla\alpha_2)^T
%\end{bmatrix}
%\end{equation}
%
%\begin{equation}
%\label{aVector}
%a =\begin{bmatrix}
%\frac{\partial \alpha_1}{\partial t} \quad   \frac{\partial \alpha_2}{\partial t} \quad   0
%\end{bmatrix}^T
%\end{equation}



%GVFs can be constructed for more complex paths, such as the sine path depicted in Figure \ref{fig:sinewavePath}
%\begin{figure}[H]
%	\centering
%	\label{fig:sinewavePath}
%	\includegraphics[width=12cm,trim=0 200 0 220,clip]{Figures/sineVectorField}
%	\caption{GVF converging and circulating a sine wave path}
%
%\end{figure}



%A GVF for converging and circulating a circular path can be produced by intersecting a plane and a cylinder $(\alpha_1 = z,\alpha_2 = x^2+y^2-r^2)$.


%The Goncalves method produces an \textit{n}-dimensional vector field that converges and circulates a static or time-varying path defined by \textit{(n-1)} implicit surfaces ($\alpha_i:\mathbb{R}^n\rightarrow\mathbb{R} | i=1,...,n-1$). The surface functions can represent any shape as long as they satisfy the two conditions that $1)$ they are positive definite and $2)$ have bounded derivatives. Consider the space with dimensions in set \textbf{q}:


GVF was compared against LVF in a standoff tracking scenario in [Wilhelm] where a fixed wing UAV was tasked with with loitering around a moving ground target while avoiding static obstacles.  A circular time-varying attractive vector field was attached to a moving ground target. Static circular repulsive vector fields centered at the obstacles and weighted by hyperbolic tangent decay functions were summed with the attractive circular field to produce a target loitering and obstacle avoidance guidance. The performance of Lyapunov \cite{frew_cooperative_2007} and gradient vector field \cite{goncalves_artificial_2009,goncalves_circulation_2010,goncalves_vector_2010} were compared for their cross track error with respect to the loiter circle. Gradient vector field had favorable performance due to compensation for a time-varying vector field. The gradient vector field technique also has the benefit of decoupled weighting parameters for convergence, circulation, and time-varying terms, allowing for easy modification of field behavior. \\

The presence of singularities were not addressed in [Wilhelm], mentioned briefly in \cite{nelson_cooperative_2005} and observed in \cite{panagou_motion_2014}. For fixed wing UAVs the lack of guidance may prevent the UAV from avoiding an obstacle, while multi-rotor UAVs may end up in a trap situation. Singularities may be present at any location where a goal field and obstacle field are of equal strength. Detecting singularities and modifying the GVF for an improved obstacle avoidance is now considered.

%
%Decay functions for avoidance fields using GVF were also investigated in [Zhu] for obstacles present on a straight path. When summing attractive and repulsive vector fields there is the possibility of guidance singularities, where magnitude and direction are equal and opposite. 













%\section{Optimal Path}
%\begin{equation}\label{eq:optPath}
%y = \frac{u}{\dot{theta}} \newline
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%X = obstX - \sqrt{(turnR-obstR)^2-(y-obstY)^2}
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%\Theta = \sin^{-1}\Bigg(\frac{y-obstY}{obstR+turnR}\Bigg)
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%\beta = \Big[\frac{3\pi}{2},\pi-\Theta\Big]
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%\gamma = \Big[\pi-\Theta,\Theta\Big]
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%\zeta = \Big[\pi+\Theta,\frac{30pi}{2}\Big]
%\end{equation}
%
%\begin{equation}\label{eq:optPath}
%x = 
%\begin{cases} 
%0 & X+turnR*cos(beta) \\
%\frac{100-x}{100} & obstX + obstR*cos(gamma) \\
%0 & -X+turnR*cos(zeta) 
%\end{cases}
%\end{equation}



% For highly uncertain or dynamic environments, path planning may have to occur frequently which increases communication overhead for the autopilot
%
%% The state of the environment would then need to be transmitted back to the ground station and a new optimized and refined path be generated along with a series of waypoints. 
%%
%%
%%
%%During waypoint navigation the UAV may encounter obstacles or environmental changes that would require a new set of obstacle free waypoints to be generated. 
%
%
%For highly uncertain or dynamic environments, there may have to be frequent updates which increases the communication overhead of the autopilot since paths may be updated and communicated from the ground. Additionally, if communication is delayed or lost, waypoints may not be updated rapidly enough and the UAV may fail to avoid the obstacles if the autopilot is following outdated waypoints that violate an obstacle. Real time obstacle avoidance without the need to replan may be found in the use of potential and vector fields, which operate on the principle of artificial attractive and repulsive forces to guide a robotic system. 






\section{Methods}

The static weight vector field for straight lines and circular obstacles will be presented. A numerical method for detecting singularities in a summed vector field will be discussed. The modified vector field law with dynamic weights will be presented. Simulations comparing waypoint, potential field, and vector field guidance will be presented for worst case scenario with an obstacle centered on the sensor path. 

\subsection{Path Following with GVF}
Path following guidance for a planar UAV at position $(x,y)$ for a time invariant line is achieved by summing together convergence $\overrightarrow{V}_{conv}$ and circulation $\overrightarrow{V}_{circ}$ terms shown in Equation \ref{eq:simpleGVF}, where the plane defined by implicit surface function $\alpha_1$ is at angle $\delta$ and plane $\alpha_2$ is at constant height of $Z = 1$ shown in Equations \ref{eq:pathFunction} and \ref{eq:pathFunctionZ} respectively. The surfaces can be depicted in Figure \ref{fig:planeIntersection}.


\begin{equation}
\label{eq:pathFunction}
\alpha_1 = cos(\delta)x + sin(\delta)y
\end{equation}

\begin{equation}
\label{eq:pathFunctionZ}
\alpha_2 = z
\end{equation}

The gradient potential, $\nabla V$ is shown in Equation \ref{eq:potentialFunctionGrad}.

\begin{equation}
\label{eq:potentialFunctionGrad}
\nabla V = -\frac{1}{2(\sqrt{\cos^2(\delta) x^2+2\cos(\delta)\sin(\delta) xy +\sin^2 (\delta) y^2})} \begin{bmatrix}
2x\cos^2(\delta) + 2\cos(\delta)\sin(\delta) y \\
2y\sin^2(\delta) + 2\cos(\delta)\sin(\delta) x \\
2
\end{bmatrix}
\end{equation}

Circulation is calculated by the cross product of the surface function gradients, which evaluates to that shown in Equation \ref{eq:circStraightPart2}.



\begin{equation}
\label{eq:circStraightPart2}
\overrightarrow{V}_{circ} = \begin{bmatrix}
sin(\theta) \\
-cos(\theta) \\
0
\end{bmatrix}
\end{equation}

\begin{figure}[H]
	\centering
	\includegraphics[trim=0 20 0 20,clip,width=10cm]{Figures/planeIntersection}
	\caption{Plane intersection}
	\label{fig:planeIntersection}
\end{figure}

Guidance for a path at angle $\delta = 0$ and equal parts circulation and convergence weights $G=H=1$ is shown in Figure \ref{fig:GVFLine}. How quickly the path following field transitions from convergence to circulation depends on the field weights. Equal parts convergence and circulation are shown in Figure \ref{fig:GVFLine}a $(G=H=1)$ and a larger circulation value in Figure \ref{fig:GVFLine}b $(G=1, H=5)$.

\begin{figure}[H]
	\begin{subfigmatrix}{2}% number of columns
		\centering	
		\subfigure []{\includegraphics[trim=15 10 0 30,clip,width=8cm] {Figures/methods/straightPathH1}}
		\subfigure []{\includegraphics[trim=15 10 0 30,clip,width=8cm] {Figures/methods/straightPathH5}}
		
		\hspace*{0mm}
	\end{subfigmatrix}
	\caption{GVF converging and a) H=1 b) H=5}
	\label{fig:GVFLine}
\end{figure} 



\subsection{Avoidance}

Previous works [wwc] avoided obstacles with a circular GVF modified with a tangent hyperbolic decay function. The circular avoidance vector field centered at $(x_c,y_c)$ and with radius $r$ is constructed by intersecting a cylinder, Equation \ref{eq:alphaCylinder}, and a plane \ref{eq:pathFunctionZ}. 

\begin{equation}\label{eq:alphaCylinder}
\alpha_1 = (x-x_c)^2 + (y-y_c)^2-r^2
\end{equation}


Convergence is calculated by the gradient of the potential function \ref{eq:potentialFunctionGrad}, which when simplified evaluates to

\begin{equation}
\nabla V = A\overrightarrow{B}
\end{equation}

where


\begin{equation}
A = \dfrac{-1}{\sqrt{\bar{x}^4+\bar{y}^4+2\bar{x}^2\bar{y}^2-2r^2\bar{x}^2-2r^2\bar{y}^2+r^2+z^2}}
\end{equation}

\begin{equation}
\overrightarrow{B} = \begin{bmatrix} 2\bar{x}^3+2\bar{x}\bar{y}^2-2r^2\bar{x} \\ 2\bar{y}^3+2\bar{x}^2\bar{y}-2r^2\bar{y} \\z \end{bmatrix}
\end{equation}

and


\begin{equation}
\bar{x} = x - x_c
\end{equation}
\begin{equation}
\bar{y} = y - y_c
\end{equation}

Circulation is calculated from the cross product of each implicit surface function's gradient, which simplifies to

\begin{equation}\label{eq:vcirc_circle}
\overrightarrow{V}_{circ} =  \begin{bmatrix}  2(y-y_c) \\[6pt] -2(x-x_c) \\[6pt] 0\end{bmatrix}
\end{equation}



Strictly repulsion guidance is produced by assigning a negative weight to the convergence term $G=-1$, no circulation $H=0$, and a small path radius $r$ to prevent trap situations. Limiting the distance at which the field has influence is achieved with a decay function shown in Equation \ref{eq:decay} where $d$ is the range to the center of the obstacle and $R$ is the radius where the field has near zero strength. 

\begin{equation}
\label{eq:decay}
P = -\tanh \bigg( \frac{2\pi d}{R}-\pi\bigg)+1
\end{equation}

\begin{equation}
\label{eq:range}
d = \sqrt{ \bar{x}^2+\bar{y}^2}
\end{equation}

A strictly repulsive field $\overrightarrow{V}_{obst}$ with $G=-1$, $H=0$, $r=0.01$, and $R = 35$ is shown in Figure \ref{fig:decayApplied}a. Adding equal magnitude circulation and decay $G=-1$, $H=1$ is shown in Figure \ref{fig:decayApplied}b.


% ====== KEEP FOR THESIS =========
%Guidance for avoiding a circular path with a large radius can be produced by setting the convergence weight $G=-1$ and circulation weight $H=0$, shown in Figure \ref{fig:largerepulsive}. 
%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/largeRepulsive}
%	\caption{Repulsive Circular Field with Large Radius}
%	\label{fig:largerepulsive}
%\end{figure}
%
%Note that inside of the path, vectors point towards the center of the circle which may produce a trap situation if the UAV ends up inside the radius. The radius of the path can be reduced, as shown in Figure \ref{fig:normalizedrepulsive} where $r=0.01$, to prevent trap situations.
%
%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/normalizedRepulsive}
%	\caption{Repulsive Circular Field with Small Radius}
%	\label{fig:normalizedrepulsive}
%\end{figure}
%
%Obstacle fields should only act locally on a UAV guidance which is accomplished by applying a decay function for a field of radius $R$. The decay strength $P$ is determined in \ref{eq:decay}, where $d$ is the euclidean distance, or range, between the UAV and the center of the obstacle, shown in Equation \ref{eq:range}. At a distance $d>R$ the decay strength $P$ is effectively zero, having virtual no influence on the total guidance. At a distance $d\leq R$, the field strength is bounded between $[0,2]$.
%
%
%
%
%Applying the decay function with a decay edge radius $R = 35$ to the GVF shown in figure \ref{fig:normalizedrepulsive}, results in the field shown in Figure \ref{fig:decayapplied}.
%

%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/tanH}
%	\caption{}
%	\label{fig:tanh}
%\end{figure}


\begin{figure}[H]
	\begin{subfigmatrix}{2}% number of columns
		\centering	
		\subfigure []{\includegraphics[trim=0 10 20 20,clip,width=8cm] {Figures/methods/decayApplied}}
		\subfigure []{\includegraphics[trim=0 10 20 20,clip,width=8cm] {Figures/methods/decayAppliedCirculation}}
		\hspace*{0mm}
	\end{subfigmatrix}
	\caption{Repulsive GVF a) no circulation and b) with circulation}
	\label{fig:decayApplied}
\end{figure} 




%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/decayAppliedCirculation}
%	\caption{}
%	\label{fig:decayappliedcirculation}
%\end{figure}

Path following guidance and repulsive obstacle avoidance is achieved by summing the two fields together, producing the UAVs guidance $\overrightarrow{V}_G$ shown in Equation \ref{eq:totalGuidanceObstacle}.

\begin{equation}
\label{eq:totalGuidanceObstacle}
\overrightarrow{V}_g = \overrightarrow{V}_{path} + P\overrightarrow{V}_{obst}
\end{equation}




\subsection{Singularity Detection}
Singularities may be present in the above guidance due to the repulsive vectors of the obstacle canceling out the path following vectors. Identifying the location of these singularities will now be addressed. Singularities are expected to exist where the magnitude of the vector $\overrightarrow{V}_g$ has a magnitude equal to zero, shown in Equation \ref{eq:singularityCondition}. Analytical solutions to singularity condition may be difficult to obtain when the path is non-linear and multiple solutions may also exist. A numerical approach with initial conditions placed at the radius of equal strength, $R/2$, can be used to determine the location of singularities in the summed GVF guidance. 


 \begin{equation}
\label{eq:singularityCondition}
||\overrightarrow{V}_g || = 0
\end{equation}







 
%Multiple singularities or near zero guidance regions may exist, so several initial conditions must be evaluated to increase the probability of detection. With the path and obstacle field shown in \ref{fig:summedquiver}, several initial conditions evenly spaced were evaluated both inside and outside of the equal strength circle. Note how only points left of the obstacle were evaluated since this region is where attractive and repulsive vectors oppose each other, therefore it is where singularities are expected. Both inside and outside initial conditions determine the location of the singularities. 




%Solving for the location of singularities using a numerical solver with initial conditions placed at the radius of equal strength for the field in \ref{fig:summedquiver} is shown in Figure \ref{fig:noCircSingularityDetection}a. Modifying the repulsive field with a non-zero circulation weight can reduce the number of singularities as well as remove them for the UAVs path. Additionally, circulation directs the UAV around obstacle in a deterministic way. A circulation weight of $H=1$ produces the guidance with a singularity removed from the path shown in Figure \ref{fig:noCircSingularityDetection}b. Determining the exact values of $R$ and $H$ to produce an avoidance guidance that minimizes deviation from the path will now be discussed. 




%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Obsty0}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Obsty-100}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Obsty-500}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/ObstR142}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/ObstR242}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/ObstR1142}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Vs25}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Vs50}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/semiFinalAlgorithm/Vs100}
%	\caption{}
%	\label{fig:obsty0}
%\end{figure}



%\subsection{Flight Envelope}
%Evaluating a large number of initial conditions to improve the probability of finding singularities may be computationally expensive and may also find singularities the UAV may not encounter. Selecting a reduced set of initial conditions and to determine if the singularities exist where the UAV may fly, a flight envelope is determined for some time horizon $t_h$. Consider the UAV depicted in Figure \ref{fig:flightenvelope2} with a turn rate $\dot{\theta}$ and fixed speed $u$. 
%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/flightEnvelope2}
%	\caption{}
%	\label{fig:flightenvelope2}
%\end{figure}
%
%The flight envelope, or positions the UAV, at time $t_i$ with respect to the body frame is calculated in Equations \ref{eq:qx} and \ref{eq:qy}
%
%\begin{equation}
%\label{eq:qx}
%q_x =  \frac{u}{\dot{\theta}} \sin(t_h \dot{\theta})
%\end{equation}
%
%\begin{equation}
%\label{eq:qy}
%q_y =  \frac{u}{\dot{\theta}} \big(1-\cos(t_h \dot{\theta})\big)
%\end{equation}
%
%It is convenient to represent points on the flight envelope in the global inertial frame. The flight envelope points $(q_x,q_y)$ can be expressed in vector form by finding the angle $\phi$ with respect to the body frame $\hat{x}_b$ axis and the vector magnitude $q$ shown in equations \ref{eq:qphi} and \ref{eq:qMag} respectively.
%
%
%
%\begin{equation}
%\label{eq:qphi}
%\phi = \tan^{-1} \bigg( \frac{q_y}{q_x} \bigg)
%\end{equation}
%
%\begin{equation}
%\label{eq:qMag}
%q = \sqrt{q_x^2 +q_y^2}
%\end{equation}
%
%
%
%\begin{equation}
%\label{eq:pos}
%\overrightarrow{Q_b} = \begin{bmatrix}
%	q\cos\phi \\
%	q\sin\phi \\
%	0
%\end{bmatrix}
%\end{equation}
%
%To express the flight envelope in the global inertial frame, the position vector of the UAV $\overrightarrow{P}_0$ and $\theta$ are applied with a rotation matrix $R$, shown in Equations \ref{eq:pos}, \ref{eq:rotation}, and \ref{eq:qGlobal} below. 
%
%
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=0.7\linewidth]{Figures/methods/flightEnvelope}
%	\caption{}
%	\label{fig:flightenvelope}
%\end{figure}
%
%
%\begin{equation}
%\label{eq:rotation}
%\overrightarrow{P}_0 = \begin{bmatrix}
%x & y & 0
%\end{bmatrix}^T
%\end{equation}
%
%
%\begin{equation}
%\label{eq:qGlobal}
%   R=\begin{bmatrix}
%	\cos(\theta) & -\sin(\theta) & 0 \\
%	\sin(\theta) & \cos(\theta) & 0 \\
%	0 & 0 & 1 \\
%\end{bmatrix}
%\end{equation}
%
%
%\begin{equation}
%\label{eq:pos}
%\overrightarrow{Q}_0 = \overrightarrow{P_0} + R  \overrightarrow{Q_b}
%\end{equation}
%
%Initial conditions placed on the flight envelope will follow the magnitude gradient of the GVF guidance and locate any singularities it may encounter. When a singularity is found to exist inside or near a flight envelope the field can be modified to counteract it. 



\subsection{Static Modified Weights}

Determining the decay radius $R$ and circulation weight $H$ for a repulsive vector field depends on the UAVs speed $u$ and turnrate $\dot{\theta}$. An obstacle located at a lateral distance $Y_0$ from the pre-planned sensor path has a radius $r_O$ equal to a scalar multiple of the UAVs turn radius, shown in Equation \ref{eq:n}. The multiple $n$ is bounded on the interval $[1,\infty)$.

\begin{equation}
\label{eq:n}
r_O = n \theta_r
\end{equation}

The repulsive field decay radius $R$, expressed in $k$ multiples of the obstacles radius is shown in Equation \ref{eq:k} and also bounded on the interval $[1,\infty)$.

\begin{equation}
\label{eq:k}
R = k r_O
\end{equation}

The decay multiple $k$ and circulation $H$ are then determined by minimizing the cost function $\ref{eq:staticCost}$, where $y$ is the lateral deviation from the path in the $I$ frame and the function $j$ penalizes the UAV for entering the obstacle radius. The sign of $H$ can be determined from the LOS angle between the UAV and the obstacle such that the UAV travels around the obstacle in the correct, least distance, direction.

\begin{equation}
\label{eq:staticCost}
\begin{aligned}
& \underset{H,k}{\text{minimize}}
& & \frac{1}{R}\int_{t_f}^{0}ydt + j(x,y) 
\end{aligned}
\end{equation}


\begin{equation}
j(x,y) = \left\{
\begin{array}{ll}
100dt & \quad \sqrt{(x-xc)^2+(y-yc)^2} \leq r_O \\
0 & \quad \sqrt{ (x-xc)^2+(y-yc)^2 } > r_O
\end{array}
\right.
\end{equation}




A comparison of a UAVs route using a strictly repulsive vector field versus a vector field with circulation is shown in Figure \ref{fig:noCircVsCirc}. A UAV with a speed of $u=20 m/s$ and turning rate of $\dot{\theta} = 20 deg/s$ following a straight vector field path is shown avoiding an obstacle of radius $n=2$.

\begin{figure}[H]
	\begin{subfigmatrix}{2}% number of columns
		\centering	
		\subfigure []{\includegraphics[trim=35 25 55 30,clip,width=8cm] {Figures/methods/quiverWithoutCirc}}
		\subfigure []{\includegraphics[trim=40 25 55 30,clip,width=8cm] {Figures/methods/quiverWithCirc}}
		\hspace*{0mm}
	\end{subfigmatrix}
	\caption{Repulsive and Circulating VF Guidance UAV Route}
	\label{fig:noCircVsCirc}
\end{figure}

The definition of obstacle and decay field radius in terms of vehicle turn radius $\theta_r$ allows for a single decay factor $k$ and circulation $H$ to be applicable for multiple velocities. This generalizes the avoidance field parameter selection problem and allows for a two dimensional lookup table to be generated for a number of obstacle radius factors $n$ and obstacle lateral positions $Y_0$ for real time obstacle avoidance. \\



%\subsection{Modified Path Following Vector Field}
%The summed guidance results in the UAV leaving the path pre-maturely and slowly returns to the path. Gradually leaving and returning to the path is a result of the slow transition between attractive and repulsive field dominating the guidance. It is desired that the UAV follows the path up until the UAV must turn to avoid the obstacle and quickly return to the path. To accomplish this, a modification to attractive and repulsive fields must take place. Additionally, improved tracking of the outside of the obstacle can be achieved by modifying the convergence strength of the repulsive field. The modified vector field guidance with attractive weight $M$ and repulsive weight $N$ is considered without a decay function $P$, shown in Equation \ref{eq:modifiedGuidance}
%
%
%\begin{equation}
%\label{eq:modifiedGuidance}
%\overrightarrow{V}_g = M \overrightarrow{V}_{path} + N \overrightarrow{V}_{obst}
%\end{equation}
%
%
%While the UAVs horizontal position $x$ in the $I$ frame is less than the turning distance $\tilde{x}$, the attractive weight $M=1$ and the repulsive weight is null at $N=0$. Once the UAVs horizontal position reaches the turning distance, $x=\tilde{x}$ the attractive field weight switches to null $M=0$ and repulsive weight dominates at $N=1$. The repulsive field has a constant circulation of unity with sign equal to that of the UAVs lateral position with respect to the $I$ frame. Convergence becomes a function of the UAVs relative heading with respect to the obstacle center $\beta$, defined in Equation \ref{eq:beta}.  
%
%\begin{equation}
%\label{eq:beta}
%\beta = \pi - \tan^{-1} \Bigg(\frac{y-Y_0}{x}\Bigg) + \theta
%\end{equation}
%
%The convergence weight becomes:
%\begin{equation}
%\label{eq:gModified}
%g = -\cos(|\beta|)
%\end{equation}
%
%When the UAV has a heading towards the obstacle center, the repulsion is maximized at $-1$. As the UAVs heading becomes perpendicular to the LOS to the obstacle center, the repulsion falls off to zero and circulation dominates. If the UAVs heading begins to drift back towards the obstacle, either by wind or another external disturbance, $g$ will decrease to counteract the deviation. When the UAVs horizontal position $x>\hat{x}$ the repulsive field weight nulls $N=0$ and the attractive field becomes unity $M=1$. \\
%
%The modified VF guidance eliminates the need for a minimizer or lookup table, eliminates singularities since the two fields will never be equal strength, and provides a guidance comparable to waypoint guidance without the need to re-plan a path. 


\subsection{Optimal Avoidance Route for Straight Path}
A geometrically optimal route around a circular obstacle can be used to compare the performance of avoidance algorithms. The path for avoiding a circular obstacle while maximizing the sensor path coverage can be accomplished with three circular arc turns. The circular obstacle is defined to have a radius $R$ and a lateral distance $Y_0$ from the sensor path in frame $I$. The first and third arc utilize the UAVs minimum turning radius, $\theta_r$, calculated in Equation \ref{eq:turnRadius}. The start of the first minimum radius turn begins when the UAV's horizontal position $x$ reaches  $\tilde{x}$ from the path frame origin. At a horizontal position $-\hat{x}$ the UAV turns with a radius of the obstacle $R$ and exits when the UAVs horizontal position reaches $\hat{x}$. 

\begin{equation}
\label{eq:turnRadius}
\theta_r = \frac{u}{\dot{\theta}}
\end{equation}

The horizontal points $\tilde{x}$ and $\hat{x}$ are shown in Equations \ref{eq:optPathXtilde} and \ref{eq:optPathXhat} respectively. 

\begin{equation}
\label{eq:optPathXtilde}
\widetilde{x} = -\sqrt{(\theta_r+R)^2 - (\theta_r-Y_o)^2}
\end{equation}

\begin{equation}
\label{eq:optPathXhat}
\hat{x} = \frac{R\sqrt{(r+R)^2-(\theta_r-Y_o)^2}}{R+\theta_r}
\end{equation}

The avoidance path for navigating around a circular obstacle with maximum coverage of a sensor line is defined in Equation \ref{eq:optPath} and shown in Figure \ref{fig:optimalpath}.


\begin{equation}
\label{eq:optPath}
y(x) = \left\{
\begin{array}{ll}
\widetilde{y} -\sqrt{\theta_r^2 - (x-\widetilde{x})^2} &  x < -\hat{x} \\
Y_o +\sqrt{R^2 - x^2} & -\hat{x} \leq x \geq \hat{x}\\
\widetilde{y} -\sqrt{\theta_r^2 - (x+\widetilde{x})^2}&  x > -\hat{x}
\end{array}
\right.
\end{equation}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth ,trim=0 265 0 20,clip,width=15cm]{Figures/optimalPath/optimalPath}
	\caption{Optimal Kinematic Path Around Circular Obstacle}
	\label{fig:optimalpath}
\end{figure}

The avoidance path represents the optimal path around a circular obstacle and would be used to generate waypoints for waypoint guidance.

\subsection{Dubins Model}
The dynamics of UAVs can be represented by modeling the UAV as a Dubin's vehicle \cite{frew_cooperative_2007,griffiths_vector_2006,nelson_cooperative_2005,nelson_vector_2006,nelson_vector_2007}. It is assumed that the autopilots control system is capable of maintaining stability, speed $u$, and can turn the vehicle at a fixed turn rate $\dot{\theta}$. The position of the UAV $\overrightarrow{X}$ at time $t$ is calculated from the integral of the velocity vector $\overrightarrow{U}$, Equation \ref{eq:uavPosition}. Heading is an input from a guidance system, such as waypoint, potential field, or vector field.

\begin{equation}
\label{eq:uavVelocity}
\overrightarrow{U}(t) = u \begin{bmatrix}
cos(\theta(t)) \\
sin(\theta(t))
\end{bmatrix}
\end{equation}


\begin{equation}
\label{eq:uavPosition}
\overrightarrow{X}(t) = \overrightarrow{U}dt + \overrightarrow{X}(t-1)
\end{equation}


\begin{equation}
\label{turnRate}
\dot{\theta} \leq 20 deg/s
\end{equation}


\section{Simulations}

A simulation comparing waypoint, VFF, and GVF guidance for avoiding a static obstacle will be presented. A fixed wing UAV at an initial position $(-400,0)$ and heading $\theta=0^\circ$ follows the straight path connecting the points $(-400,0)$ and $(700,0)$ respectively. Traveling at a constant speed $u=25 m/s$ and with a fixed turn rate of $\dot{\theta}=20 deg/s$ the UAV must avoid an obstacle with radius $2\theta_r$ located at the origin $(0,0)$. The VFF guidance from \cite{borenstein_real-time_1990} is used with an obstacle window radius of $\theta_r+r_o$, a cell repulsion $Fr=-3$, attraction force $F_t=0.8$, range exponent $n=2$, and a goal located at $(700,0)$. For LOS waypoint guidance, waypoints were placed at $(-153,0) (0,215)(200,0)$ and $(700,0)$ with a waypoint detection radius of $\theta_r$. GVF guidance with a circular repulsive field was assigned a convergence weight $G=-1$ and circulation and decay radius coefficient $k$ were determined by evaluating the cost function in Equation \ref{eq:staticCost} with initial conditions $k_i = 2$ and $H=2$. The GVF solution was bounded such that $2\leq k\leq 4$ and $1\leq H\leq 6$. Minimizing the cost function resulted in a decay radius coefficient $k=2.78$ and a circulation value $H=1.88$. The Dubin's paths for the three guidance methods discussed is shown in Figure \ref{fig:comparemethods}. 

VFF results in a UAV route that has excess deviation from the planned path with excessive turns. Waypoint guidance returns to the path more quickly than VFF, however deviates from the planned path farther then necessary. GVF leaves the path before waypoint guidance and tracks the outside of the obstacle closely and then quickly converges back to the pre-planned path. The cost of each method is displayed in the bar plot shown in Figure \ref{fig:barplotperformance}.


\begin{figure}[H]
	\centering
	\includegraphics[trim=0 50 0 65,clip,width=15cm]{Figures/Simulations/compareMethods}
	\caption{Path of UAV guided by guidance methods}
	\label{fig:comparemethods}
\end{figure}


\begin{figure}[H]
	\centering
	\label{fig:barPlotCost}
	\includegraphics[width=15cm]{Figures/Simulations/barPlotPerformance}
	\caption{Cost performance for various UAV guidance methods}
	\label{fig:barplotperformance}
\end{figure}





\section{Conclusion}
Vector field guidance with optimized weights for avoiding obstacles and minimally deviating from a planned path was presented and compared to guidance methods in literature. Conventional methods for avoiding obstacles may require human intervention and require paths to be re-planned, such as waypoint navigation. Potential field eliminates the need for a path planner when encountering a new obstacle, however is not ideal for path following scenarios such as surveying a sensor line. Vector field guidance avoids re-planning and avoids an obstacle while returning to the original pre-planned path by selecting decay radius and circulation that minimizes a path deviation cost function. Singularities in the vector field are also avoided when circulation is added to the decay field. Future work to improve vector field for avoidance may include optimizing field parameters at each time step, potentially increasing time spent on the sensor line.

\bibliography{bib}

\end{document}
